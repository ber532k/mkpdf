# Name

mkpdf - A simple wrapper around pandoc and latexmk

# Synopsis

```
mkpdf [options] <directory>
mkpdf [options] <files>
```

# Description

Mkpdf is a wrapper around pandoc and latexmk that aims at simplifying the
generation of pdfs from plain text files written in a markup language pandoc
understands, such as pandoc's own variant of markdown.


# Options

-c, \--clean
: Remove the relevant temporary files before running latexmk. If `-c` is
specified as the only option, all temporary files will be removed.

-d, \--debug
: Print latexmk's output directly to stdout. If `-d` is specified as the only
option, an interactive loop will be used to search through all relevant
logfiles and display those that didn't, or didn't yet, exit ok.

-o FILENAME, \--output=FILENAME
: Specify a name for the output file. If this option is specified multiple
times, all but the first one will be ignored.

-p, \--preview
: Open the output file after it has been generated, using the system's default
pdf viewer.

-t FILENAME, \--template=FILENAME
: Specify a template to use with pandoc. If this option is specified multiple
times, all but the first one will be ignored.

-h, \--help
: Print a short help message and exit.

## Pandoc-Options

The following options will be passed on to pandoc. Please refer to pandoc's
documentation for further information.

-M KEY[=VAL], \--metadata=KEY[:VAL]
: Specify metadata fields directly from the command line, such as `-M lang=en`
or `--metadata="lang:en"`.


# Templates

Pandoc uses templates, which act as a sort of frame in which the converted
markup content (in this case, the latex code) is embedded. Templates can either
be specified using relative or absolute paths or using only the name, if the
template is located at one of the places, where pandoc looks for templates by
default. I.\ e.\ in `/usr/share/pandoc/data/templates` for globally available
templates or in `~/.pandoc/templates` for templates available only for specific
users. Further information on pandoc templates can be found in pandoc's
documentation.


# Directory Mode

Mkpdf allows you to specify an entire directory as input. In fact, if mkpdf is
invoked without any file or directory name as input, it will default to using
the current working directory. This directory must contain a file named
`toc.conf`, which is used to point to other files and may optionally contain
metadata blocks. Filenames are specified relative to the directory `toc.conf`
is located in and must not contain whitespace. Comments can be included by
prefixing lines or parts of lines with `#`. An example `toc.conf` could look
like this:

```
---
author: Max Mustermann
title: Some example document
template: default.latex
...

# Intro
intro.txt

# Chapters
ch1/part1.txt
ch1/part2.md    # This is also a comment

ch2.txt

---
bibliography:
  - bibfile1.bib
  - bibfile2.bib
---
```


# Configuration

The mkpdf configuration file is located at `~/.config/mkpdfrc` and will be
sourced at each invokation of the script. This even allows to use some basic
shell scripting to e.\ g.\ enclose configuration options in conditionals. It
also allows for comments by prefixing lines with `#`. Options are specified or
unset as simple shell variables:

```
# Set option_1 to value
option_1="value"
# Set boolean option_2 to false
unset option_2
```


## Boolean Options

clean
: Always remove temporary files before running latexmk.

debug
: Always print latexmk's output to stdout.

preview
: Always open pdf after generation.

## Other Options

default_template
: Use the following template as default if none is specified from command line
or via metadata fields.

pandoc_options
: Use the following command line options when invoking pandoc. If you want to
add options, rather than to replace default options, you can do that as
follows:

```
pandoc_options="$pandoc_options --new-option"
```

tmpdir
: The root of the directory where mkpdf stores the temporary files it creates.
Note that this directory is completely removed with `mkpdf -c`, so make sure it
is not used for any other purpose. Default value: `/tmp/mkpdf`.

## Postprocessing

Mkpdf will run postprocessing options on the tex files generated by pandoc
before invoking latexmk. These postprocessing options are specified within a
shell function which receives the path to the tex file as an argument
(accessible as `$1`). The default definition is as follows:

```
postprocessing() {
    test "$(which furbishtex 2>/dev/null)" && furbishtex "$1"
}
```

To use custom postprocessing, you can simply define a function called
postprocessing in your configuration file. This custom function will then be
invoked instead of the default one. To completely disable postprocessing,
simply unset the default definition:

```
unset postprocessing
```


# Author

Frank Seifferth <ber532k@gmx.de>. Feel free to contact me with feedback or
suggestions.
